tribe.validation={},function(o,l,d){"use strict";var u=l(document);o.selectors={item:".tribe-validation",fields:"input, select, textarea",submit:".tribe-validation-submit",submitButtons:'input[type="submit"], button[type="submit"]',error:".tribe-validation-error",valid:".tribe-validation-valid",notice:".tribe-notice-validation",noticeAfter:".wp-header-end",noticeFallback:".wrap > h1",noticeDismiss:".notice-dismiss"},o.conditions={isRequired:function(t){return""!=t},isGreaterThan:function(t,e,a){var i=o.parseConditon("isGreaterThan",t,e,a);return!1===i||i.constraint<i.value},isGreaterOrEqualTo:function(t,e,a){var i=o.parseConditon("isGreaterOrEqualTo",t,e,a);return!1===i||i.constraint<=i.value},isLessThan:function(t,e,a){var i=o.parseConditon("isLessThan",t,e,a);return!1===i||i.constraint>i.value},isLessOrEqualTo:function(t,e,a){var i=o.parseConditon("isLessOrEqualTo",t,e,a);return!1===i||i.constraint>=i.value},isEqualTo:function(t,e,a){var i=o.parseConditon("isEqualTo",t,e,a);return!1===i||i.constraint==i.value},isNotEqualTo:function(t,e,a){var i=o.parseConditon("isNotEqualTo",t,e,a);return!1===i||i.constraint!=i.value},matchRegExp:function(t,e,a){return null!==new RegExp(e,"g").exec(t)},notMatchRegExp:function(t,e,a){return null===new RegExp(e,"g").exec(t)}},o.parseType={datepicker:function(t,e,a){var i=["yyyy-mm-dd","m/d/yyyy","mm/dd/yyyy","d/m/yyyy","dd/mm/yyyy","m-d-yyyy","mm-dd-yyyy","d-m-yyyy","dd-mm-yyyy","yyyy.mm.dd","mm.dd.yyyy","dd.mm.yyyy"],n=0;e.length&&e.attr("data-datepicker_format")?n=e.attr("data-datepicker_format"):d.isString(i[e])?n=i[e]:e.parents("[data-datepicker_format]").length&&(n=e.parents("[data-datepicker_format]").eq(0).data("datepicker_format")),void 0!==i[n]&&i[n]||(n=0);var r=i[n].toUpperCase();return t=moment(t,r).format("X")},default:function(t,e,a){return l.isNumeric(t)&&(t=parseFloat(t,10)),t}},o.parseConditon=function(t,e,a,i){var n=i.data("validationType"),r=null,s={value:e,constraint:a};if(n||d.isFunction(o.parseType[n])||(n="default"),!l.isNumeric(a)){if(!(r=l(a)).length)return console.warn("Tribe Validation:","Invalid selector for",i,a),!1;if(!(r=r.not(":disabled")).length)return!1;a=r.val()}return s.constraint=o.parseType[n](a,r,i),s.value=o.parseType[n](e,r,i),s},o.constraints={isRequired:function(t){var e=null;return e=t.data("required")||e,e=t.data("validationRequired")||e,e=t.data("validationIsRequired")||e,e=t.is("[required]")||e,e=t.is("[data-required]")||e,e=t.is("[data-validation-required]")||e,e=t.is("[data-validation-is-required]")||e},isGreaterThan:function(t){var e=null;return t.is("[data-validation-is-greater-than]")&&(e=t.data("validationIsGreaterThan")),e},isGreaterOrEqualTo:function(t){var e=null;return t.is("[data-validation-is-greater-or-equal-to]")&&(e=t.data("validationIsGreaterOrEqualTo")),e},isLessThan:function(t){var e=null;return t.is("[data-validation-is-less-than]")&&(e=t.data("validationIsLessThan")),e},isLessOrEqualTo:function(t){var e=null;return t.is("[data-validation-is-less-or-equal-to]")&&(e=t.data("validationIsLessOrEqualTo")),e},isEqualTo:function(t){var e=null;return t.is("[data-validation-is-equal-to]")&&(e=t.data("validationIsEqualTo")),e},isNotEqualTo:function(t){var e=null;return t.is("[data-validation-is-not-equal-to]")&&(e=t.data("validationIsNotEqualTo")),e},matchRegExp:function(t){var e=null;return t.is("[data-validation-match-regexp]")&&(e=t.data("validationMatchRegexp")),e},notMatchRegExp:function(t){var e=null;return t.is("[data-validation-not-match-regexp]")&&(e=t.data("validationNotMatchRegexp")),e}},o.fn=function(){return this.each(o.setup)},o.setup=function(t,e){var a=l(e);a.addClass(o.selectors.item.className()),a.find(o.selectors.submitButtons).addClass(o.selectors.submit.className()),a.on("submit.tribe",o.onSubmit),a.on("validation.tribe",o.onValidation),a.on("displayErrors.tribe",o.onDisplayErrors),u.on("click.tribe",o.selectors.submit,o.onClickSubmitButtons),u.on("click.tribe",o.selectors.noticeDismiss,o.onClickDismissNotice)},o.validate=function(t,e){var a=l(e);o.isValid(a)||(a.addClass(o.selectors.error.className()),a.one("change",o.onChangeFieldRemoveError))},o.isValid=function(t){var e=o.getConstraints(t);return d.isObject(e)?d.every(e):e},o.hasErrors=function(t){return 0!==t.find(o.selectors.error).not(":disabled").length},o.getConstraints=function(a){if(a.is(":disabled"))return!0;var t=o.getConstraintsValue(a),i=a.val();return!!d.isEmpty(t)||(t=d.mapObject(t,function(t,e){return o.conditions[e](i,t,a)}))},o.getConstraintsValue=function(e){var t={};return e.is(":disabled")?t:(t=o.constraints,t=d.mapObject(t,function(t){return t(e)}),t=d.pick(t,function(t){return null!==t}))},o.getConstraintsFields=function(t){var e=o.getConstraintsValue(t);return e=d.mapObject(e,function(t){var e=null;return d.isNumber(t)||d.isBoolean(t)||(e=l(t)),e}),e=d.pick(e,function(t){return t instanceof jQuery}),(e=d.values(e)).unshift(t),e=l(e).map(function(){return this.get()})},o.onValidation=function(t){var e=l(this),a=e.find(o.selectors.fields);a.removeClass(o.selectors.error.className()),a.each(o.validate),0===e.find(o.selectors.error).not(":disabled").length?e.addClass(o.selectors.valid.className()):e.trigger("displayErrors.tribe")},o.onDisplayErrors=function(t){var e=l(this).find(o.selectors.error).not(":disabled"),s=l("<ul>"),a=l("<span>").addClass(o.selectors.noticeDismiss.className()),i=u.find(o.selectors.notice),n=l("<div>").addClass("notice notice-error is-dismissible tribe-notice").addClass(o.selectors.notice.className()).append(a);if(e.each(function(t,e){var a=l(e),i=a.data("validationError");if(d.isObject(i)){var n={},r=o.getConstraints(a,!1);d.each(i,function(t,e){n[tribe.utils.camelCase(e)]=t}),d.each(r,function(t,e){t||o.addErrorLine(n[e],a,s)})}else o.addErrorLine(i,a,s)}),n.append(s),0===i.length){var r=u.find(o.selectors.noticeAfter);0===r.length&&(r=u.find(o.selectors.noticeFallback)),r.after(n)}else i.replaceWith(n)},o.addErrorLine=function(t,e,a){var i=l("<li>").text(t);i.data("validationField",e),e.data("validationNoticeItem",e),a.append(i)},o.onSubmit=function(t){var e=l(this);if(e.trigger("validation.tribe"),!e.is(o.selectors.valid))return t.preventDefault(),!1},o.onClickSubmitButtons=function(t){var e=l(this).parents(o.selectors.item);if(0!==e.length){e.trigger("validation.tribe");var a=e.find(o.selectors.fields);a.off("invalid.tribe"),a.one("invalid.tribe",o.onInvalidField)}},o.onInvalidField=function(t){var e=l(this),a=e.parents(o.selectors.item);return e.addClass(o.selectors.error.className()),a.trigger("displayErrors.tribe"),e.one("change",o.onChangeFieldRemoveError),t.preventDefault(),!1},o.onChangeFieldRemoveError=function(t){var e=l(this),a=o.getConstraintsFields(e);0!==a.filter(o.selectors.error).length&&a.removeClass(o.selectors.error.className())},o.onClickDismissNotice=function(t){l(this).parents(o.selectors.notice).remove()},o.onReady=function(t){l(o.selectors.item).validation()},l.fn.validation=o.fn,u.ready(o.onReady)}(tribe.validation,jQuery,window.underscore||window._);