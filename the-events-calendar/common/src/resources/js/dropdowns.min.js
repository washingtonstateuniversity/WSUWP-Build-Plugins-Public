var tribe_dropdowns=tribe_dropdowns||{};!function(s,n,c){"use strict";n.selector={dropdown:".tribe-dropdown",created:".tribe-dropdown-created"},s.fn.tribe_dropdowns=function(){return n.dropdown(this),this},n.freefrom_create_search_choice=function(e,t){var a=this.opts,r=a.$select;if(e.match(a.regexToken)&&(!r.is("[data-int]")||r.is("[data-int]")&&e.match(/\d+/))){var o={id:e,text:e,new:!0};return r.is("[data-create-choice-template]")&&(o.text=c.template(r.data("createChoiceTemplate"))({term:e})),o}},n.allow_html_markup=function(e){return e},n.search_id=function(e){var t=void 0;return void 0!==e.id?t=e.id:void 0!==e.ID?t=e.ID:void 0!==e.value&&(t=e.value),void 0===e?void 0:t},n.matcher=function(e,t){var a=this.element.data("dropdown"),r=-1!==t.toUpperCase().indexOf(e.toUpperCase());if(!r&&void 0!==a.tags){var o=c.where(a.tags,{text:t});if(0<a.tags.length&&c.isObject(o))r=-1!==n.search_id(o[0]).toUpperCase().indexOf(e.toUpperCase())}return r},n.init_selection=function(r,e){var t=r.is("[multiple]"),o=r.data("dropdown"),a=r.val().split(o.regexSplit),i=[];s(a).each(function(e,t){var a=function e(t,a){if(!s.isArray(a))return!1;for(var r in a){var o=a[r];if(o.hasOwnProperty("id")&&o.id==t.id)return o;if(o.hasOwnProperty("text")&&o.text==t.text)return o;if(o.hasOwnProperty("children")&&s.isArray(o.children)){var i=e(t,o.children);if(i)return i}}return!1}({id:this,text:this},o.ajax?r.data("options"):o.data);a&&i.push(a)}),i.length&&t?e(i):i.length&&e(i[0])},n.element=function(e,a){var t,r=s(e),o=(a=s.extend({},a),["depends","condition","conditionNot","condition-not","conditionNotEmpty","condition-not-empty","conditionEmpty","condition-empty","conditionIsNumeric","condition-is-numeric","conditionIsNotNumeric","condition-is-not-numeric","conditionChecked","condition-is-checked"]);if(r.addClass(n.selector.created.className()),a.$select=r,a.dropdownAutoWidth=!0,a.containerCss={},r.is(":visible")&&(a.containerCss.display="inline-block"),a.dropdownCss={},a.dropdownCss.width="auto",r.is("[data-dropdown-css-width]")&&(a.dropdownCss.width=r.data("dropdown-css-width"),a.dropdownCss.width||delete a.dropdownCss.width),a.matcher=n.matcher,r.is("select")||(a.id=n.search_id),a.allowClear=!0,r.is("[data-prevent-clear]")&&(a.allowClear=!1),r.is("[data-searching-placeholder]")&&(a.formatSearching=r.data("searching-placeholder")),r.is("[data-options]")&&(a.data=r.data("options"),r.is("select")||(a.initSelection=n.init_selection)),r.is("[data-allow-html]")&&(a.escapeMarkup=n.allow_html_markup),r.is("[data-hide-search]")&&(a.minimumResultsForSearch=1/0),r.is("[data-freeform]")&&(a.createSearchChoice=n.freefrom_create_search_choice),r.is("[multiple]")&&(a.multiple=!0,r.is("[data-maximum-selection-size]")&&(a.maximumSelectionSize=r.data("maximum-selection-size")),r.is("data-separator")||r.data("separator",","),c.isArray(r.data("separator"))?a.tokenSeparators=r.data("separator"):a.tokenSeparators=[r.data("separator")],a.separator=r.data("separator"),a.regexSeparatorElements=["^("],a.regexSplitElements=["(?:"],s.each(a.tokenSeparators,function(e,t){a.regexSeparatorElements.push("[^"+t+"]+"),a.regexSplitElements.push("["+t+"]")}),a.regexSeparatorElements.push(")$"),a.regexSplitElements.push(")"),a.regexSeparatorString=a.regexSeparatorElements.join(""),a.regexSplitString=a.regexSplitElements.join(""),a.regexToken=new RegExp(a.regexSeparatorString,"ig"),a.regexSplit=new RegExp(a.regexSplitString,"ig")),r.is("[data-tags]")&&(a.tags=r.data("tags"),a.initSelection=n.init_selection,a.createSearchChoice=function(e,t){if(e.match(a.regexToken))return{id:e,text:e}},0===a.tags.length&&(a.formatNoMatches=function(){return r.attr("placeholder")})),r.is("[data-source]")){var i=r.data("source");a.data={results:[]},a.escapeMarkup=n.allow_html_markup,a.formatResult=function(e,t,a){return void 0!==e.breadcrumbs?s.merge(e.breadcrumbs,[e.text]).join(" &#187; "):e.text},a.ajax={dataType:"json",type:"POST",url:n.ajaxurl(),results:function(e,t,a){return s.isPlainObject(e)&&void 0!==e.success?s.isPlainObject(e.data)&&void 0!==e.data.results?e.success?e.data:("string"===s.type(e.data.message)?console.error(e.data.message):console.error("The Select2 search failed in some way... Verify the source."),{results:[]}):(console.error("We received a malformed results array, could not complete the Select2 Search."),{results:[]}):(console.error("We received a malformed Object, could not complete the Select2 Search."),{results:[]})}},a.ajax.data=function(e,t){return{action:"tribe_dropdown",source:i,search:e,page:t,args:r.data("source-args")}}}r.data("dropdown",a),t=r.select2(a).select2("container"),0<o.length&&o.map(function(e){var t="data-"+e,a=r.attr(t);a&&this.attr(t,a)},t)},n.action_change=function(e){var t=s(this),a=s(this).data("value");t.is("[multiple]")&&t.is("[data-source]")&&(e.added?c.isArray(a)?a.push(e.added):a=[e.added]:a=c.isArray(a)?c.without(a,e.removed):[],t.data("value",a).attr("data-value",JSON.stringify(a)))},n.ajaxurl=function(){return void 0!==window.ajaxurl?window.ajaxurl:"undefined"!=typeof TEC&&void 0!==TEC.ajaxurl?TEC.ajaxurl:void console.error("Dropdowns framework cannot properly do an AJAX request without the WordPress `ajaxurl` variable setup.")},n.action_select2_removed=function(e){var t=s(this);t.is("[data-sticky-search]")&&t.is("[data-last-search]")&&t.removeAttr("data-last-search").removeData("lastSearch")},n.action_bugfix_group_select=function(e){var t=s(this).select2("data");s(".select2-drop:visible").find(".select2-selected").each(function(){var e=s(this),a=e.data("select2-data"),r=!0;void 0!==a.children&&(s.each(t,function(e,t){n.search_id(a)==n.search_id(t)&&(r=!1)}),r&&e.removeClass("select2-selected"))})},n.action_select2_close=function(e){var t=s(this),a=s(".select2-drop .select2-input.select2-focused");t.is("[data-sticky-search]")&&a.off("keyup-change.tribe")},n.action_select2_open=function(e){var t=s(this),a=s(".select2-drop .select2-input:visible");t.is("[data-search-placeholder]")&&a.attr("placeholder",t.data("searchPlaceholder")),t.is("[data-sticky-search]")&&(a.on("keyup-change.tribe",function(){t.data("lastSearch",s(this).val()).attr("data-last-search",s(this).val())}),t.is("[data-last-search]")&&a.val(t.data("lastSearch")).trigger("keyup-change"))},n.dropdown=function(e,a){var t=e.not(".select2-offscreen, .select2-container, "+n.selector.created.className());return 0===t.length||(a||(a={}),t.each(function(e,t){n.element(t,a)}).on("select2-open",n.action_select2_open).on("select2-close",n.action_select2_close).on("select2-removed",n.action_select2_removed).on("select2-loaded",n.action_bugfix_group_select).on("change",n.action_change)),t},s(function(){s(n.selector.dropdown).tribe_dropdowns()}),s(window).on("unload",function(){s(n.selector.dropdown).tribe_dropdowns()})}(jQuery,tribe_dropdowns,window.underscore||window._);